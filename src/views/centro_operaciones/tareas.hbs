<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tareas</title>
</head>
<body>
    <h1>Tareas para el turno de {{nombre}}</h1>
    <h2>Turno: {{turno}}</h2>
    <form action="/marcar-tarea" method="post">
        <!-- Tarea: Recepciones Aeropuerto -->
        <div style="display: flex; justify-content: space-between;">
            <label style="text-align: left;" for="recepciones">Recepciones Aeropuerto:</label>
            <div>
                <input type="checkbox" id="recepciones_realizado" name="recepciones_realizado" value="realizado">
                <label for="recepciones_realizado">Realizado</label>
                <input type="checkbox" id="recepciones_no_aplica" name="recepciones_no_aplica" value="no_aplica">
                <label for="recepciones_no_aplica">No Aplica</label>
                <input type="checkbox" id="recepciones_no_realizado" name="recepciones_no_realizado" value="no_realizado">
                <label for="recepciones_no_realizado">No Realizado</label>
            </div>
        </div>
        <div id="motivo_recepciones" style="display:none; margin-left: 180px;">
            <label for="recepciones_motivo">Motivo (si no realizado):</label><br>
            <textarea id="recepciones_motivo" name="recepciones_motivo" rows="4" cols="50"></textarea><br><br>
        </div>

        <!-- Tarea: Reporte de novedades -->
        <div style="display: flex; justify-content: space-between;">
            <label style="text-align: left;" for="reporte_novedades">Reporte de novedades:</label>
            <div>
                <input type="checkbox" id="reporte_novedades_realizado" name="reporte_novedades_realizado" value="realizado">
                <label for="reporte_novedades_realizado">Realizado</label>
                <input type="checkbox" id="reporte_novedades_no_aplica" name="reporte_novedades_no_aplica" value="no_aplica">
                <label for="reporte_novedades_no_aplica">No Aplica</label>
                <input type="checkbox" id="reporte_novedades_no_realizado" name="reporte_novedades_no_realizado" value="no_realizado">
                <label for="reporte_novedades_no_realizado">No Realizado</label>
            </div>
        </div>
        <div id="motivo_reporte_novedades" style="display:none; margin-left: 180px;">
            <label for="reporte_novedades_motivo">POR QUE NO REALIZO EL REPORTE DE NOVEDADES?:</label><br>
            <textarea id="reporte_novedades_motivo" name="reporte_novedades_motivo" rows="4" cols="50"></textarea><br><br>
        </div>

        <!-- Repite el mismo patrón para las demás tareas -->
        <!-- Tarea: Información de pagos -->
        <div style="display: flex; justify-content: space-between;">
            <label style="text-align: left;" for="info_pagos">Información de pagos:</label>
            <div>
                <input type="checkbox" id="info_pagos_realizado" name="info_pagos_realizado" value="realizado">
                <label for="info_pagos_realizado">Realizado</label>
                <input type="checkbox" id="info_pagos_no_aplica" name="info_pagos_no_aplica" value="no_aplica">
                <label for="info_pagos_no_aplica">No Aplica</label>
                <input type="checkbox" id="info_pagos_no_realizado" name="info_pagos_no_realizado" value="no_realizado">
                <label for="info_pagos_no_realizado">No Realizado</label>
            </div>
        </div>
        <div id="motivo_info_pagos" style="display:none; margin-left: 180px;">
            <label for="info_pagos_motivo">Motivo (si no realizado):</label><br>
            <textarea id="info_pagos_motivo" name="info_pagos_motivo" rows="4" cols="50"></textarea><br><br>
        </div>

        <!-- Tarea: Revisión de servicios en efectivo -->
        <div style="display: flex; justify-content: space-between;">
            <label style="text-align: left;" for="revision_servicios">Revisión de servicios en efectivo:</label>
            <div>
                <input type="checkbox" id="revision_servicios_realizado" name="revision_servicios_realizado" value="realizado">
                <label for="revision_servicios_realizado">Realizado</label>
                <input type="checkbox" id="revision_servicios_no_aplica" name="revision_servicios_no_aplica" value="no_aplica">
                <label for="revision_servicios_no_aplica">No Aplica</label>
                <input type="checkbox" id="revision_servicios_no_realizado" name="revision_servicios_no_realizado" value="no_realizado">
                <label for="revision_servicios_no_realizado">No Realizado</label>
            </div>
        </div>
        <div id="motivo_revision_servicios" style="display:none; margin-left: 180px;">
            <label for="revision_servicios_motivo">Motivo (si no realizado):</label><br>
            <textarea id="revision_servicios_motivo" name="revision_servicios_motivo" rows="4" cols="50"></textarea><br><br>
        </div>

        <!-- Tarea: Coordinación de tareas de TaskGo -->
        <div style="display: flex; justify-content: space-between;">
            <label style="text-align: left;" for="coordinacion_tareas">Coordinación de tareas de TaskGo:</label>
            <div>
                <input type="checkbox" id="coordinacion_tareas_realizado" name="coordinacion_tareas_realizado" value="realizado">
                <label for="coordinacion_tareas_realizado">Realizado</label>
                <input type="checkbox" id="coordinacion_tareas_no_aplica" name="coordinacion_tareas_no_aplica" value="no_aplica">
                <label for="coordinacion_tareas_no_aplica">No Aplica</label>
                <input type="checkbox" id="coordinacion_tareas_no_realizado" name="coordinacion_tareas_no_realizado" value="no_realizado">
                <label for="coordinacion_tareas_no_realizado">No Realizado</label>
            </div>
        </div>
        <div id="motivo_coordinacion_tareas" style="display:none; margin-left: 180px;">
            <label for="coordinacion_tareas_motivo">Motivo (si no realizado):</label><br>
            <textarea id="coordinacion_tareas_motivo" name="coordinacion_tareas_motivo" rows="4" cols="50"></textarea><br><br>
        </div>

        <!-- Tarea: Revisar servicios de tripulaciones -->
        <div style="display: flex; justify-content: space-between;">
            <label style="text-align: left;" for="revision_tripulaciones">Revisar servicios de tripulaciones:</label>
            <div>
                <input type="checkbox" id="revision_tripulaciones_realizado" name="revision_tripulaciones_realizado" value="realizado">
                <label for="revision_tripulaciones_realizado">Realizado</label>
                <input type="checkbox" id="revision_tripulaciones_no_aplica" name="revision_tripulaciones_no_aplica" value="no_aplica">
                <label for="revision_tripulaciones_no_aplica">No Aplica</label>
                <input type="checkbox" id="revision_tripulaciones_no_realizado" name="revision_tripulaciones_no_realizado" value="no_realizado">
                <label for="revision_tripulaciones_no_realizado">No Realizado</label>
            </div>
        </div>
        <div id="motivo_revision_tripulaciones" style="display:none; margin-left: 180px;">
            <label for="revision_tripulaciones_motivo">Motivo (si no realizado):</label><br>
            <textarea id="revision_tripulaciones_motivo" name="revision_tripulaciones_motivo" rows="4" cols="50"></textarea><br><br>
        </div>

        <!-- Tarea: Registro de PQRS de clientes -->
        <div style="display: flex; justify-content: space-between;">
            <label style="text-align: left;" for="registro_pqrs">Registro de PQRS de clientes:</label>
            <div>
                <input type="checkbox" id="registro_pqrs_realizado" name="registro_pqrs_realizado" value="realizado">
                <label for="registro_pqrs_realizado">Realizado</label>
                <input type="checkbox" id="registro_pqrs_no_aplica" name="registro_pqrs_no_aplica" value="no_aplica">
                <label for="registro_pqrs_no_aplica">No Aplica</label>
                <input type="checkbox" id="registro_pqrs_no_realizado" name="registro_pqrs_no_realizado" value="no_realizado">
                <label for="registro_pqrs_no_realizado">No Realizado</label>
            </div>
        </div>
        <div id="motivo_registro_pqrs" style="display:none; margin-left: 180px;">
            <label for="registro_pqrs_motivo">Motivo (si no realizado):</label><br>
            <textarea id="registro_pqrs_motivo" name="registro_pqrs_motivo" rows="4" cols="50"></textarea><br><br>
        </div>

        <!-- Tarea: Novedades Diarias -->
        <div style="display: flex; justify-content: space-between;">
            <label style="text-align: left;" for="novedades_diarias">Novedades Diarias:</label>
            <div>
                <input type="checkbox" id="novedades_diarias_realizado" name="novedades_diarias_realizado" value="realizado">
                <label for="novedades_diarias_realizado">Realizado</label>
                <input type="checkbox" id="novedades_diarias_no_aplica" name="novedades_diarias_no_aplica" value="no_aplica">
                <label for="novedades_diarias_no_aplica">No Aplica</label>
                <input type="checkbox" id="novedades_diarias_no_realizado" name="novedades_diarias_no_realizado" value="no_realizado">
                <label for="novedades_diarias_no_realizado">No Realizado</label>
            </div>
        </div>
        <div id="motivo_novedades_diarias" style="display:none; margin-left: 180px;">
            <label for="novedades_diarias_motivo">Motivo (si no realizado):</label><br>
            <textarea id="novedades_diarias_motivo" name="novedades_diarias_motivo" rows="4" cols="50"></textarea><br><br>
        </div>

        <br><br>

        <!-- Agregar firma -->
        <label for="firma"><strong>FIRMA DE {{nombre}}</strong></label><br>
        <canvas id="firmaCanvas" width="400" height="200" style="border:1px solid #000;"></canvas><br>
        <button type="button" onclick="limpiarFirma()">Limpiar Firma</button><br>
        <input type="hidden" id="firmaBase64" name="firmaBase64"><!-- Aquí se almacenará la firma en formato base64 -->
        
        <!-- Agregar campo oculto para el nombre -->
        <input type="hidden" name="nombre" value="{{nombre}}">
        
        <!-- Botón para guardar las tareas marcadas -->
        <input type="submit" value="Guardar Tareas Marcadas">
        <hr>
    </form>
    <script>
        var canvas = document.getElementById('firmaCanvas');
        var ctx = canvas.getContext('2d');

        // Variables para controlar el estado de la firma
        var firmaActiva = false;
        var lastX = 0;
        var lastY = 0;

        // Eventos de ratón para dibujar la firma
        canvas.addEventListener('mousedown', function(e) {
            firmaActiva = true;
            [lastX, lastY] = [e.offsetX, e.offsetY];
        });

        canvas.addEventListener('mousemove', function(e) {
            if (firmaActiva) {
                var currentX = e.offsetX;
                var currentY = e.offsetY;
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(currentX, currentY);
                ctx.stroke();
                [lastX, lastY] = [currentX, currentY];
            }
        });

        canvas.addEventListener('mouseup', function() {
            firmaActiva = false;
        });

        // Convertir la firma en base64 y almacenarla en el campo oculto
        function guardarFirma() {
            var firmaBase64 = canvas.toDataURL();
            console.log("Firma en formato base64:", firmaBase64);
            document.getElementById('firmaBase64').value = firmaBase64;
        }

        function limpiarFirma() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            document.getElementById('firmaBase64').value = '';
            console.log("Firma borrada");
        }
        canvas.addEventListener('touchstart', function(e) {
            firmaActiva = true;
            var touch = e.touches[0];
            [lastX, lastY] = [touch.clientX - canvas.offsetLeft, touch.clientY - canvas.offsetTop];
        });

        canvas.addEventListener('touchmove', function(e) {
            e.preventDefault(); // Evita el desplazamiento de la página en dispositivos táctiles
            if (firmaActiva) {
                var touch = e.touches[0];
                var currentX = touch.clientX - canvas.offsetLeft;
                var currentY = touch.clientY - canvas.offsetTop;
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(currentX, currentY);
                ctx.stroke();
                [lastX, lastY] = [currentX, currentY];
            }
        });

        canvas.addEventListener('touchend', function() {
            firmaActiva = false;
        });

        // Mostrar u ocultar el campo de motivo según la selección de "No Realizado" para cada tarea
        document.getElementById('recepciones_no_realizado').addEventListener('change', function() {
            var motivoDiv = document.getElementById('motivo_recepciones');
            if (this.checked) {
                motivoDiv.style.display = 'block';
            } else {
                motivoDiv.style.display = 'none';
            }
        });

        document.getElementById('reporte_novedades_no_realizado').addEventListener('change', function() {
            var motivoDiv = document.getElementById('motivo_reporte_novedades');
            if (this.checked) {
                motivoDiv.style.display = 'block';
            } else {
                motivoDiv.style.display = 'none';
            }
        });

        // Repite el mismo patrón para las demás tareas
        document.getElementById('info_pagos_no_realizado').addEventListener('change', function() {
            var motivoDiv = document.getElementById('motivo_info_pagos');
            if (this.checked) {
                motivoDiv.style.display = 'block';
            } else {
                motivoDiv.style.display = 'none';
            }
        });

        document.getElementById('revision_servicios_no_realizado').addEventListener('change', function() {
            var motivoDiv = document.getElementById('motivo_revision_servicios');
            if (this.checked) {
                motivoDiv.style.display = 'block';
            } else {
                motivoDiv.style.display = 'none';
            }
        });

        document.getElementById('coordinacion_tareas_no_realizado').addEventListener('change', function() {
            var motivoDiv = document.getElementById('motivo_coordinacion_tareas');
            if (this.checked) {
                motivoDiv.style.display = 'block';
            } else {
                motivoDiv.style.display = 'none';
            }
        });

        document.getElementById('revision_tripulaciones_no_realizado').addEventListener('change', function() {
            var motivoDiv = document.getElementById('motivo_revision_tripulaciones');
            if (this.checked) {
                motivoDiv.style.display = 'block';
            } else {
                motivoDiv.style.display = 'none';
            }
        });

        document.getElementById('registro_pqrs_no_realizado').addEventListener('change', function() {
            var motivoDiv = document.getElementById('motivo_registro_pqrs');
            if (this.checked) {
                motivoDiv.style.display = 'block';
            } else {
                motivoDiv.style.display = 'none';
            }
        });

        document.getElementById('novedades_diarias_no_realizado').addEventListener('change', function() {
            var motivoDiv = document.getElementById('motivo_novedades_diarias');
            if (this.checked) {
                motivoDiv.style.display = 'block';
            } else {
                motivoDiv.style.display = 'none';
            }
        });
    </script>
</body>
</html>
